<div nz-row>
    @if(submittedSuccesfull==false){
    <div nz-col nzSpan="24" style="max-width: 100%">
        <h3>{{'Create Configuration' | translate }}</h3>
        <p class="text-drawer-header"> {{'Manage your configurations by creating a new one or updating existing ones by switching them on/off or editing their details.' | translate}}</p>
    </div>
    }
    @if(submittedSuccesfull==true){
    <div nz-col nzSpan="24" style="max-width: 100%">
        <h3>{{'Configuration Is Successfully Created' | translate }}</h3>
        <p class="text-drawer-header"> {{'Your configuration has been created and is currently inactive. View and change its status from the list with all configurations.' | translate}}</p>
    </div>
    }
</div>
<form [formGroup]="form">
    <div style="overflow-y: auto; max-height: 1250px;height: 1250px;">
        @if(submittedSuccesfull==false){
        <div nz-row style="margin-top: 15px;">
            <div nz-col nzSpan="24" style="max-width: 100%">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Name' | translate}} </mat-label>
                    <input type="text" placeholder="{{'Name'| translate}}" matInput formControlName="name"
                        autocomplete="off">
                        @if(submitted && f['name'].errors){
                         <div  class="invalid-feedback">
                            @if(f['name'].errors['required']){
                                <div>{{'Name' | translate}} {{'is required' | translate}}</div>
                            }
                          </div>
                        }            
                </mat-form-field>
            </div>
        </div>
        <div nz-row>
            <div nz-col nzSpan="24" style="max-width: 100%">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Region' | translate}} </mat-label>
                    <mat-select disableRipple formControlName="region_id" (selectionChange)="onRegioChange($event)">
                        @for (regio of this.arrCombos['REGION']; track regio) {
                            <mat-option [value]="regio.id">{{regio.name}}</mat-option>
                        }                     
                    </mat-select>
                    @if(submitted && f['region_id'].errors){
                    <div  class="invalid-feedback">
                        @if(f['region_id'].errors['required']){
                            <div>{{'Region' | translate}} {{'is required' | translate}}</div>
                        }
                    </div>
                     }
                </mat-form-field>
            </div>
        </div>
        <div nz-row>
            <div nz-col nzSpan="11">
                <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>{{'Primary color' | translate}} </mat-label>
                    <input matInput formControlName="primary_color" />
                    <ngx-colors class="suffix" matSuffix ngx-colors-trigger
                        formControlName="pickerCtrl_primary"></ngx-colors>
                        @if(submitted && f['primary_color'].errors){
                            @if(submitted && f['primary_color'].errors){
                                <div  class="invalid-feedback">
                                    @if(f['primary_color'].errors['required']){
                                        <div>{{'Primary color' | translate}} {{'is required' | translate}}</div>
                                    }
                                </div>
                            }
                        }
                </mat-form-field>
            </div>
            <div nz-col nzSpan="2">&nbsp; </div>
            <div nz-col nzSpan="11">
                <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>{{'Secundary color' | translate}} </mat-label>
                    <input matInput formControlName="secondary_color" />
                    <ngx-colors class="suffix" matSuffix ngx-colors-trigger
                        formControlName="pickerCtrl_secundary"></ngx-colors>
                        @if(submitted && f['secondary_color'].errors){
                            <div  class="invalid-feedback">
                                @if(f['secondary_color'].errors['required']){
                                    <div>{{'Secondary color' | translate}} {{'is required' | translate}}</div>
                                }
                            </div>
                        }
                </mat-form-field>
            </div>
        </div>
        <div nz-row>
            <div nz-col nzSpan="24"> {{'Logo' | translate}}</div>
            <div nz-col nzSpan="24">
                <ngx-dropzone class="dropzone" style="border: 1px solid #717386;" (change)="onSelectLogo($event)"
                    [multiple]="false" [maxFileSize]="3000000" accept="image/jpeg,image/jpg,image/png,image/bmp">
                    <ngx-dropzone-label>
                        <div class="dz-message needsclick">
                            <i nz-icon nzType="cloud-upload" style="font-size: 55px;"></i>
                            <h6 class="f-14">{{ 'Drop a file here or click to upload' | translate }} {{ 'logo' |
                                translate }}.</h6>
                            <span>{{'JPG, PNG or BMP up to 3 MB' | translate }}</span>
                        </div>
                    </ngx-dropzone-label>
                    <!--<ngx-dropzone-preview *ngFor="let f of files" [removable]="true" (removed)="onRemoveLogo(f)">
                        <ngx-dropzone-label>{{ f.name }} ({{ f.type }}) </ngx-dropzone-label>
                    </ngx-dropzone-preview>-->
                    <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview" *ngFor="let f of files" [file]="f" [removable]="true" (removed)="onRemoveLogo(f)">
                        <ngx-dropzone-label style="position:unset!important;">{{ f.name }}</ngx-dropzone-label>
                    </ngx-dropzone-image-preview>
                </ngx-dropzone>
                <img class="display-logo max-logo200 d-block d-sm-none mt-3" [src]="f['logo'].value">
            </div>
        </div>
        <div nz-row>
            <div nz-col nzSpan="24"> {{'Watermark' | translate}}</div>
            <div nz-col nzSpan="24">
                <ngx-dropzone class="dropzone" style="border: 1px solid #717386;" (change)="onSelectWaterMark($event)"
                    [multiple]="false" [maxFileSize]="3000000" accept="image/jpeg,image/jpg,image/png,image/bmp">
                    <ngx-dropzone-label>
                        <div class="dz-message needsclick">
                            <i nz-icon nzType="cloud-upload" style="font-size: 55px;"></i>
                            <h6 class="f-14">{{ 'Drop a file here or click to upload' | translate }} {{ 'watermark' | translate }}.</h6>
                            <span>{{'JPG, PNG or BMP up to 3 MB' | translate }}</span>
                        </div>
                    </ngx-dropzone-label>
                   <!--<ngx-dropzone-preview *ngFor="let f of files1" [removable]="true" (removed)="onRemoveWatermark(f)">
                        <ngx-dropzone-label style="position:unset!important;">{{ f.name }}</ngx-dropzone-label>
                    </ngx-dropzone-preview>-->
                    <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview" *ngFor="let f of files1" [file]="f" [removable]="true" (removed)="onRemoveWatermark(f)">
                        <ngx-dropzone-label style="position:unset!important;">{{ f.name }}</ngx-dropzone-label>
                    </ngx-dropzone-image-preview>

                </ngx-dropzone>
                <img class="display-logo max-logo200 d-block d-sm-none mt-3" [src]="f['logo'].value">
            </div>
        </div>

        <div nz-row>
            <div nz-col nzSpan="12">{{'Available' | translate}}</div>
            <div nz-col nzSpan="12">{{'Selected' | translate}}</div>
        </div>
        <div nz-row>
            <div nz-col nzSpan="11">
                <table mat-table [dataSource]="dataSource">
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef>
                            <div nz-row>
                                <div nz-col nzSpan="24">
                                    <span>
                                        <mat-checkbox (change)="selectAll($event)" [checked]="isAllSelectedAvailable()"
                                            [indeterminate]="!isAllSelectedAvailable() && isAnySelectedAvailable()">
                                        </mat-checkbox>
                                    </span>
                                    <span>{{'Available' | translate}}</span>
                                </div>
                                <div nz-col nzSpan="24">
                                    <span class="text-table-header">{{amountSelectedAvailable()}}/{{arrMaps?.length}}
                                        {{'selected'|translate}}</span>
                                </div>

                            </div>
                            <nz-divider nzPlain></nz-divider>
                            <div nz-row>
                                <div nz-col nzSpan="24">
                                    <mat-form-field appearance="outline" style="width: unset;">
                                        <mat-label>{{'Name' | translate}} </mat-label>
                                        <input type="text" placeholder="{{'Name'| translate}}" matInput
                                            (keyup)="applyFilter($event)" autocomplete="off">
                                        <mat-icon matPrefix>search</mat-icon>
                                    </mat-form-field>
                                </div>
                            </div>



                        </th>
                        <td mat-cell *matCellDef="let element">
                            <div nz-row>
                                <div nz-col nzSpan="4">
                                    <mat-checkbox (change)="$event.checked ? element.link=true : element.link=false"
                                        [checked]="element.link">
                                    </mat-checkbox>
                                </div>
                                <div nz-col nzSpan="20">
                                    {{element.name}}
                                </div>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>


                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
                <mat-paginator #paginator [pageSizeOptions]="[10,15,20,50]" showFirstLastButtons></mat-paginator>


            </div>
            <div nz-col nzSpan="2" class="link-layer">
                <div nz-row class="btn-link-layer" (click)="linkLayers()">
                    <i nz-icon nzType="right" style="font-size: 20px;"></i>
                </div>
                <div nz-row class="btn-link-layer" (click)="unllinLayers()">
                    <i nz-icon nzType="left" style="font-size: 20px;"></i>
                </div>
            </div>
            <div nz-col nzSpan="11">
                <table mat-table [dataSource]="dataSourceLinked">
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef>
                            <div nz-row>
                                <div nz-col nzSpan="24">
                                    <span>
                                        <mat-checkbox (change)="selectAllSelected($event)"
                                            [checked]="isAllSelectedSelected()"
                                            [indeterminate]="!isAllSelectedSelected() && isAnySelectedSelected()">
                                        </mat-checkbox>
                                    </span>
                                    <span>{{'Selected' | translate}}</span>
                                </div>
                                <div nz-col nzSpan="24">
                                    <span class="text-table-header">{{amountSelectedSelected()}}/{{arrMapsLinked?.length}} {{'selected'|translate}}</span>
                                </div>

                            </div>
                            <nz-divider nzPlain></nz-divider>
                            <div nz-row>
                                <div nz-col nzSpan="24">
                                    <mat-form-field appearance="outline" style="width: unset;">
                                        <mat-label>{{'Name' | translate}} </mat-label>
                                        <input type="text" placeholder="{{'Name'| translate}}" matInput
                                            (keyup)="applyFilterLinked($event)" autocomplete="off">
                                        <mat-icon matPrefix>search</mat-icon>
                                    </mat-form-field>
                                </div>
                            </div>
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <div nz-row>
                                <div nz-col nzSpan="4">
                                    <mat-checkbox (click)="$event.stopPropagation()"
                                        (change)="$event.checked ? element.link=true : element.link=false"
                                        [checked]="element.link">
                                    </mat-checkbox>
                                </div>
                                <div nz-col nzSpan="20">
                                    {{element.name}}
                                </div>
                            </div>
                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
                <mat-paginator #paginatorLinked [pageSizeOptions]="[10,15,20,50]" showFirstLastButtons></mat-paginator>
            </div>
        </div>
        }
        @if(submittedSuccesfull==true){
            <div nz-row>
                <div nz-col nzSpan="24" style="max-width: 100%">
                    <img nz-image width="700px" height="611px" style="position: absolute; top:250px;padding:25px" nzSrc="../../../../assets/img/icons/svg/configuration_created.svg" alt=""/>
                </div>
            </div>
        }
    </div>

    <div nz-row class="ant-drawer-footer">
        @if(submittedSuccesfull==false){
        <div nz-row [nzGutter]="8" style="width: 100%;">
            <div nz-col nzSpan="12">
                <button nz-button nzBlock style="width: 100%;" class="ant-btn ant-btn-default mp-button-light"
                    (click)="close()">{{'Back'|translate}}</button>
            </div>
            <div nz-col nzSpan="12">
                <button nz-button nzBlock style="width: 100%;"
                    class="ant-btn mp-group-button"
                    (click)="onSubmit()">{{(this.id!=undefined?'Update' : 'Create')|translate}}</button>
            </div>
        </div>
        }
        @if(submittedSuccesfull==true){
        <div nz-row [nzGutter]="8" style="width: 100%;">

            <div nz-col nzSpan="24">
                <button nz-button nzBlock style="width: 100%;"
                    class="ant-btn mp-group-button" (click)="close()">{{'View Configurations'|translate}}</button>
            </div>
        </div>
        }
    </div>

</form>
